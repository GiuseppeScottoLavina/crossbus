function t(t,s={}){const h=new e(s),n=t.signal.bind(t);return h.onFlush(t=>{n(i,{messages:t})}),t.signal=(t,s)=>{h.queue({event:t,data:s})},t.addInboundHook(s=>{if(s&&s.messages&&Array.isArray(s.messages)){for(const e of s.messages)t.emit(e.event,e.data);return null}return s}),t.t=h,t}function s(t={}){return new e(t)}class e{#t;#s;#e;#i=new Map;#h=null;#n=!1;#a=null;#u=0;#r=0;constructor(t={}){this.#t=t.windowMs??16,this.#s=t.maxBatchSize??100,this.#e=t.useRaf??"undefined"!=typeof requestAnimationFrame}queue(t){const s="default";this.#i.has(s)||this.#i.set(s,[]);const e=this.#i.get(s);return e&&(e.push(t),this.#r++,e.length>=this.#s?this.#o(s):this.#n||this.#c()),!0}onFlush(t){this.#a=t}flush(){for(const t of this.#i.keys())this.#o(t)}get stats(){return{batchesSent:this.#u,messagesBatched:this.#r,pendingMessages:this.#l(),avgBatchSize:this.#u>0?Math.round(this.#r/this.#u):0}}resetStats(){this.#u=0,this.#r=0}destroy(){null!==this.#h&&(this.#e&&"undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame(this.#h):clearTimeout(this.#h)),this.#i.clear(),this.#a=null}#c(){this.#n=!0,this.#e&&"undefined"!=typeof requestAnimationFrame?this.#h=requestAnimationFrame(()=>{this.#n=!1,this.flush()}):this.#h=setTimeout(()=>{this.#n=!1,this.flush()},this.#t)}#o(t){const s=this.#i.get(t);s&&0!==s.length&&(this.#a&&(this.#a(s),this.#u++),this.#i.set(t,[]))}#l(){let t=0;for(const s of this.#i.values())t+=s.length;return t}}const i="__crossbus_batch__";export{i as BATCH_TYPE,e as MessageBatcher,s as createBatcher,t as withBatching};
//# sourceMappingURL=batch.min.js.map
