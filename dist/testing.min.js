function e(e,s){const i=new t(e),n=new t(s),r=i.send,a=n.send;return Object.defineProperty(i,"send",{get:()=>e=>{r(e),n.simulateMessage(e)}}),Object.defineProperty(n,"send",{get:()=>e=>{a(e),i.simulateMessage(e)}}),{transport1:i,transport2:n}}class t{#e;#t=[];#s=[];#i=null;#n=0;#r=!1;#a=null;#h=!0;constructor(e,t={}){this.#e=e,this.#n=t.latencyMs??0}get peerId(){return this.#e}get connected(){return this.#h}get send(){return e=>{if(this.#r)throw new Error(this.#a??"Mock send failure");if(!this.#h)throw new Error("Mock transport disconnected");this.#t.push({message:e,timestamp:Date.now()})}}onMessage(e){this.#i=e}async simulateMessage(e,t={}){const s=t.delay??this.#n;this.#s.push({message:e,timestamp:Date.now()}),s>0&&await new Promise(e=>setTimeout(e,s)),this.#i&&this.#i(e)}disconnect(){this.#h=!1}reconnect(){this.#h=!0}failOnNextSend(e){this.#r=!0,this.#a=e??null}resetFailure(){this.#r=!1,this.#a=null}getSentMessages(){return[...this.#t]}getLastSent(){return this.#t[this.#t.length-1]?.message}get sentCount(){return this.#t.length}getReceivedMessages(){return[...this.#s]}wasSent(e){return this.#t.some(({message:t})=>Object.entries(e).every(([e,s])=>JSON.stringify(t[e])===JSON.stringify(s)))}async waitForMessages(e,t=1e3){const s=Date.now();for(;this.#t.length<e;){if(Date.now()-s>t)throw new Error(`Timeout waiting for ${e} messages, got ${this.#t.length}`);await new Promise(e=>setTimeout(e,10))}return this.getSentMessages()}clear(){this.#t=[],this.#s=[]}reset(){this.clear(),this.resetFailure(),this.reconnect()}}export{t as MockTransport,e as createConnectedMocks};
//# sourceMappingURL=testing.min.js.map
